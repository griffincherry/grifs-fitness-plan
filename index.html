<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grif's Daily Exercise Plan</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC;
            color: #1E293B;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 120px;
        }
        
        .day-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        
        .day-card.active {
            border-color: #2A9D8F;
            background-color: #F0FDFA;
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(42, 157, 143, 0.1);
        }

        /* Poof Animation */
        @keyframes poof {
            0% { transform: scale(1); opacity: 1; filter: blur(0px); }
            50% { transform: scale(1.02); opacity: 0.5; filter: blur(4px); }
            100% { transform: scale(1.1); opacity: 0; filter: blur(10px); }
        }

        .poof-out {
            animation: poof 0.4s ease-out forwards;
            pointer-events: none;
        }

        /* Custom Scrollbar for Desktop/Sub Nav */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .step-list {
            list-style: none;
            padding: 0;
        }
        .step-list li {
            position: relative;
            padding-left: 1.75rem;
            margin-bottom: 0.875rem;
            line-height: 1.6;
        }
        .step-list li::before {
            content: "•";
            position: absolute;
            left: 0.25rem;
            color: #94A3B8;
            font-size: 1.4rem;
            line-height: 1;
        }

        .text-white .step-list li::before {
            color: rgba(255, 255, 255, 0.4);
        }

        /* Timer Circle Animation */
        .timer-svg {
            transform: rotate(-90deg);
        }
        
        .timer-circle {
            transition: stroke-dashoffset 1s linear;
        }

        /* Hide/Show logic based on standard device breakpoints */
        @media (max-width: 767px) {
            .desktop-nav { display: none; }
            .mobile-nav { display: block; }
        }
        @media (min-width: 768px) {
            .desktop-nav { display: block; }
            .mobile-nav { display: none; }
        }
    </style>
</head>
<body onload="initApp()">

    <!-- Hero Header -->
    <header class="bg-slate-900 text-white py-10 md:py-16 px-6 text-center">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl md:text-5xl lg:text-6xl font-extrabold tracking-tight">Grif's Daily Exercise Plan</h1>
            <p class="text-slate-400 mt-3 text-base md:text-lg font-medium">Consistency is the key to longevity.</p>
        </div>
    </header>

    <!-- Content Container -->
    <main class="max-w-screen-md lg:max-w-screen-lg mx-auto px-4 md:px-8 -mt-8">
        
        <!-- MAIN NAVIGATION (iPad Landscape / Desktop) -->
        <section class="desktop-nav bg-white rounded-3xl shadow-xl p-4 mb-8 border border-slate-100 overflow-x-auto hide-scrollbar">
            <div id="day-selector" class="flex lg:grid lg:grid-cols-8 gap-2 min-w-max lg:min-w-0"></div>
        </section>

        <!-- MAIN NAVIGATION (iPhone / iPad Portrait) -->
        <section class="mobile-nav mb-8">
            <div class="relative">
                <select id="mobile-day-select" onchange="selectDay(parseInt(this.value))" 
                    class="w-full bg-white border-2 border-teal-500 text-slate-800 font-bold py-4 px-6 rounded-2xl shadow-lg appearance-none focus:outline-none text-lg">
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-4 text-teal-600">
                    <svg class="fill-current h-6 w-6" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
        </section>

        <!-- ROUTINE HEADER & SUB-NAV -->
        <section id="routine-container" class="space-y-4 min-h-[400px]">
            <div class="flex items-end justify-between mb-2 px-1">
                <div>
                    <h2 id="current-day-title" class="text-3xl md:text-4xl font-black text-slate-800 tracking-tight">Monday</h2>
                    <span id="current-day-focus" class="text-teal-600 text-xs md:text-sm font-bold uppercase tracking-widest">Upper Body</span>
                </div>
                <button onclick="resetDayProgress()" class="text-slate-300 hover:text-rose-500 transition-colors p-2 flex items-center gap-2 group" title="Reset Day">
                    <span class="hidden md:inline text-[10px] font-bold uppercase opacity-0 group-hover:opacity-100 transition-opacity">Reset Day</span>
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                </button>
            </div>

            <!-- EXERCISE SUB-NAV -->
            <div id="exercise-nav" class="flex gap-2 overflow-x-auto hide-scrollbar pb-2 mask-fade-right">
                <!-- Dynamically populated -->
            </div>

            <!-- Single Card Focus Area -->
            <div id="exercise-list" class="relative pt-2"></div>
        </section>

    </main>

    <!-- FLOATING REST TIMER -->
    <div id="timer-widget" class="fixed bottom-6 right-6 flex items-center bg-white rounded-full shadow-2xl p-2 border border-slate-100 z-50">
        <div class="relative w-14 h-14 md:w-16 md:h-16 flex items-center justify-center cursor-pointer" onclick="toggleTimer()">
            <svg class="timer-svg w-full h-full">
                <circle cx="32" cy="32" r="28" stroke="#F1F5F9" stroke-width="4" fill="transparent" />
                <circle id="timer-progress" cx="32" cy="32" r="28" stroke="#2A9D8F" stroke-width="4" fill="transparent" 
                        stroke-dasharray="175.9" stroke-dashoffset="0" class="timer-circle" />
            </svg>
            <div id="timer-display" class="absolute inset-0 flex items-center justify-center font-black text-slate-800 text-xs md:text-sm">
                30s
            </div>
        </div>
        <div id="timer-controls" class="pr-5 pl-2 hidden sm:block">
            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Rest</p>
            <p id="timer-status" class="text-xs font-black text-slate-700">Ready</p>
        </div>
    </div>

    <script>
        // --- DATA & STATE ---
        let currentDayId = 0;
        let activeExerciseIndex = 0;
        let progress = JSON.parse(localStorage.getItem('workout_progress') || '{}');
        const DEFAULT_REST = 30; 
        let timerSeconds = DEFAULT_REST;
        let timerInterval = null;

        const appData = {
            days: [
                { id: 0, label: 'Mon', full: 'Monday', focus: 'Upper Body & Core' },
                { id: 1, label: 'Tue', full: 'Tuesday', focus: 'Posture & Alignment' },
                { id: 2, label: 'Wed', full: 'Wednesday', focus: 'Lower Body & Stability' },
                { id: 3, label: 'Thu', full: 'Thursday', focus: 'Recovery & Mobility' },
                { id: 4, label: 'Fri', full: 'Friday', focus: 'Upper Body & Core' },
                { id: 5, label: 'Sat', full: 'Saturday', focus: 'Lower Body & Stability' },
                { id: 6, label: 'Sun', full: 'Sunday', focus: 'Rest & Restoration' },
                { id: 7, label: 'Night', full: 'Before Bed', focus: 'Nightly Mobility', isNight: true }
            ],
            globalSections: {
                warmup: { name: "Warm-Up", sets: 1, target: "Joint Activation", steps: ["Arm Circles (1m): Small controlled circles, 30s forward, 30s back.", "Torso Twists (1m): Feet shoulder-width, gently rotate core side-to-side.", "Marching in Place (2m): Lift knees high and swing arms naturally.", "Shoulder Squeezes (1m): Pull shoulder blades together, hold for 2s, release."], bgColor: "bg-orange-500", textColor: "text-white", reps: "5 Minutes" },
                cooldown: { name: "Cool-Down", sets: 1, target: "Flexibility", steps: ["Cat-Cow (1m): Flow between arching and rounding your spine slowly.", "Hamstring Stretch (1m/side): Extend leg on a stool or floor, lean forward from hips.", "Child's Pose (2m): Sit back on heels, stretch arms forward, breathe deep."], bgColor: "bg-slate-800", textColor: "text-white", reps: "5 Minutes" }
            },
            exercises: {
                "Modified Floor Press": { target: "Chest/Triceps", steps: ["Lie flat on your back with knees bent and feet flat on the floor.", "Hold dumbbells with palms facing your feet, elbows resting on the ground at a 45-degree angle.", "Press the weights toward the ceiling until arms are straight.", "Lower slowly until your elbows lightly touch the floor. Pause and repeat."], video: "https://www.youtube.com/results?search_query=dumbbell+floor+press" },
                "Bicep Curls": { target: "Arms", steps: ["Stand or sit tall with weights at your sides, palms facing forward.", "Pin your elbows to your ribcage; they should not move forward or backward.", "Curl weights toward shoulders by contracting biceps.", "Lower weights slowly (count 1-2-3) to start position."], video: "https://www.youtube.com/results?search_query=bicep+curl+form" },
                "Overhead Press (Seated)": { target: "Shoulders", steps: ["Sit in a sturdy chair with your back pressed firmly against the backrest.", "Hold weights at shoulder height with palms facing forward.", "Press weights straight up until arms are fully extended.", "Control weights as you lower back to shoulder height."], video: "https://www.youtube.com/results?search_query=seated+shoulder+press" },
                "The Dead Bug": { target: "Core Stability", steps: ["Lie on back with arms reaching up and knees at 90 degrees.", "Press lower back into the floor; eliminate any gap.", "Lower right arm and left leg simultaneously toward the floor.", "Return to center and repeat with opposite limbs. Move slowly."], video: "https://www.youtube.com/results?search_query=dead+bug+exercise" },
                "Seated Knee Tucks": { target: "Lower Abs", steps: ["Sit on edge of a sturdy chair; grip sides for balance.", "Lean back slightly and extend legs forward.", "Pull knees in toward chest by engaging core.", "Slowly extend legs back out without feet touching floor."], video: "https://www.youtube.com/results?search_query=seated+knee+tucks" },
                "Plank (On Chair)": { target: "Total Core", steps: ["Place hands or forearms on a sturdy chair or bench.", "Step feet back until body forms a straight line.", "Squeeze glutes and pull belly button toward spine.", "Hold while breathing steadily through your nose."], video: "https://www.youtube.com/results?search_query=incline+plank" },
                "Cat-Cow": { target: "Spinal Mobility", steps: ["Start on hands and knees (tabletop position).", "Inhale: Drop belly, lift chin, look toward ceiling (Cow).", "Exhale: Tuck chin to chest and arch back like a cat (Cat).", "Move fluidly with your breath."], video: "https://www.youtube.com/results?search_query=cat+cow" },
                "Bird-Dog": { target: "Lower Back/Balance", steps: ["From hands and knees, extend right arm and left leg.", "Keep hips and shoulders level with the floor.", "Hold for 3 seconds, focusing on lengthening.", "Return to center and switch sides."], video: "https://www.youtube.com/results?search_query=bird+dog+exercise" },
                "Wall Slides": { target: "Upper Back/Posture", steps: ["Stand with back, head, and glutes against a wall.", "Place arms against wall in 'goalpost' position (90-degree elbows).", "Slide arms upward while keeping elbows and wrists touching wall.", "Slide back down. Focus on the squeeze between blades."], video: "https://www.youtube.com/results?search_query=wall+slides" },
                "Glute Bridges": { target: "Hips/Glutes", steps: ["Lie on back with knees bent and feet flat, hip-width apart.", "Drive through heels to lift hips toward ceiling.", "Squeeze glutes hard at the top for 1 second.", "Slowly lower hips back to floor."], video: "https://www.youtube.com/results?search_query=glute+bridge" },
                "Superman Holds": { target: "Posterior Chain", steps: ["Lie face down on floor with arms extended forward.", "Simultaneously lift arms, chest, and legs a few inches.", "Keep gaze at the floor to maintain neutral neck.", "Hold for 5 seconds, then slowly lower."], video: "https://www.youtube.com/results?search_query=superman+exercise" },
                "Sit-to-Stands": { target: "Quads/Glutes", steps: ["Sit on edge of chair with feet flat and chest tall.", "Push through heels to stand fully without using hands.", "Slowly lower yourself back (count 1-2-3).", "Lightly touch chair and immediately stand again."], video: "https://www.youtube.com/results?search_query=sit+to+stand" },
                "Calf Raises": { target: "Lower Legs", steps: ["Stand with feet hip-width, holding wall for balance.", "Rise onto balls of feet as high as possible.", "Pause at peak for 1 second to feel contraction.", "Lower heels back to floor with control."], video: "https://www.youtube.com/results?search_query=calf+raises" },
                "Side-Lying Leg Lifts": { target: "Outer Hips", steps: ["Lie on side with legs stacked and straight.", "Lift top leg toward ceiling (about 20-30 degrees).", "Keep toes pointed forward, not toward ceiling.", "Lower slowly and repeat."], video: "https://www.youtube.com/results?search_query=side+lying+leg+raise" },
                "Wall Sit": { target: "Knee Stability/Quads", steps: ["Lean against wall and slide down until thighs are parallel to floor.", "Ensure knees are directly above ankles (90-degree angle).", "Press entire back flat against wall.", "Hold for target time, breathing deeply."], video: "https://www.youtube.com/results?search_query=wall+sit" },
                "Stair Steps": { target: "Cardio/Endurance", steps: ["Find a single step or low, sturdy platform.", "Step up with right foot, then left foot.", "Step down with right foot, then left foot.", "Maintain steady, rhythmic pace for 5 minutes."], video: "https://www.youtube.com/results?search_query=stair+stepping" },
                "Deep Breathing": { target: "Nervous System", steps: ["Find a comfortable seated or lying position.", "Inhale through nose for count of 4, filling belly.", "Hold breath gently for count of 4.", "Exhale slowly through mouth for count of 4. Repeat 10x."], video: "https://www.youtube.com/results?search_query=box+breathing" },
                "Neck Tilts": { target: "Cervical Spine", steps: ["Sit or stand with tall spine and relaxed shoulders.", "Slowly lower right ear toward right shoulder.", "Hold for 5 seconds, breathing into side of neck.", "Return to center and repeat on left side."], video: "https://www.youtube.com/results?search_query=neck+tilt+stretch" },
                "Seated Chest Opener": { target: "Shoulders/Postures", steps: ["Sit on edge of bed or a chair.", "Reach hands behind back and interlace fingers.", "Straighten arms and pull shoulders down and back.", "Lift chest toward ceiling and take 3 deep breaths."], video: "https://www.youtube.com/results?search_query=seated+chest+opener" },
                "Quad Stretch (Bed)": { target: "Thighs/Hip Flexors", steps: ["Lie on right side on bed with legs straight.", "Bend left knee and grab left foot/ankle with left hand.", "Gently pull heel toward glute.", "Hold for 30s, then repeat on the other side."], video: "https://www.youtube.com/results?search_query=side+lying+quad+stretch" },
                "Child's Pose (Bed)": { target: "Lower Back/Mindfulness", steps: ["Kneel on bed, toes together, sit on heels.", "Separate knees about hip-width apart.", "Fold forward, forehead on mattress, arms out.", "Focus on breath, feeling lower back expand."], video: "https://www.youtube.com/results?search_query=childs+pose+form" }
            },
            routines: [
                [{ name: "Modified Floor Press", sets: 3, reps: "12-15" }, { name: "Bicep Curls", sets: 3, reps: "12-15" }, { name: "Overhead Press (Seated)", sets: 3, reps: "10-12" }, { name: "The Dead Bug", sets: 3, reps: "10 Per Side" }, { name: "Seated Knee Tucks", sets: 3, reps: "15-20" }, { name: "Plank (On Chair)", sets: 3, reps: "30-45 Sec" }],
                [{ name: "Cat-Cow", sets: 1, reps: "10-12 Flows" }, { name: "Bird-Dog", sets: 3, reps: "8 Per Side" }, { name: "Wall Slides", sets: 3, reps: "12-15" }, { name: "Glute Bridges", sets: 3, reps: "15-20" }, { name: "Superman Holds", sets: 3, reps: "5 Holds" }, { name: "Deep Breathing", sets: 1, reps: "10 Rounds" }],
                [{ name: "Sit-to-Stands", sets: 3, reps: "12-15" }, { name: "Calf Raises", sets: 3, reps: "15-20" }, { name: "Side-Lying Leg Lifts", sets: 3, reps: "12 Per Side" }, { name: "The Dead Bug", sets: 3, reps: "10 Per Side" }, { name: "Wall Sit", sets: 3, reps: "30-45 Sec" }],
                [{ name: "Stair Steps", sets: 1, reps: "5 Minutes" }, { name: "Wall Slides", sets: 3, reps: "12-15" }, { name: "Cat-Cow", sets: 1, reps: "10-12 Flows" }, { name: "Deep Breathing", sets: 1, reps: "10 Rounds" }],
                [{ name: "Modified Floor Press", sets: 3, reps: "12-15" }, { name: "Bicep Curls", sets: 3, reps: "12-15" }, { name: "Overhead Press (Seated)", sets: 3, reps: "10-12" }, { name: "The Dead Bug", sets: 3, reps: "10 Per Side" }, { name: "Seated Knee Tucks", sets: 3, reps: "15-20" }, { name: "Plank (On Chair)", sets: 3, reps: "30-45 Sec" }],
                [{ name: "Sit-to-Stands", sets: 3, reps: "12-15" }, { name: "Calf Raises", sets: 3, reps: "15-20" }, { name: "Bird-Dog", sets: 3, reps: "8 Per Side" }, { name: "Side-Lying Leg Lifts", sets: 3, reps: "12 Per Side" }, { name: "Wall Sit", sets: 3, reps: "30-45 Sec" }],
                [{ name: "Cat-Cow", sets: 1, reps: "10-12 Flows" }, { name: "Wall Slides", sets: 2, reps: "12-15" }, { name: "Deep Breathing", sets: 1, reps: "10 Rounds" }],
                [{ name: "Neck Tilts", sets: 2, reps: "5 Per Side" }, { name: "Seated Chest Opener", sets: 2, reps: "30 Sec Hold" }, { name: "Quad Stretch (Bed)", sets: 2, reps: "30 Sec Per Side" }, { name: "Child's Pose (Bed)", sets: 1, reps: "2 Minutes" }]
            ]
        };

        // --- APP LOGIC ---
        function initApp() {
            renderDaySelectors();
            renderMobileSelect();
            const now = new Date();
            const hour = now.getHours();
            const dayOfWeek = now.getDay(); 
            let initialId = (hour >= 17) ? 7 : (dayOfWeek === 0 ? 6 : dayOfWeek - 1);
            selectDay(initialId);
        }

        function renderDaySelectors() {
            const container = document.getElementById('day-selector');
            container.innerHTML = appData.days.map(day => `
                <div onclick="selectDay(${day.id})" id="day-card-${day.id}" class="day-card flex-1 min-w-[90px] ${day.isNight ? 'bg-indigo-50 border-indigo-100' : 'bg-white border-slate-100'} border-2 rounded-2xl p-3 text-center transition-all">
                    <span class="text-[10px] font-bold ${day.isNight ? 'text-indigo-400' : 'text-slate-400'} uppercase tracking-tighter">${day.label}</span>
                    <p class="font-black text-slate-800 text-[11px] mt-1">${day.focus.split(' ')[0]}</p>
                </div>
            `).join('');
        }

        function renderMobileSelect() {
            const select = document.getElementById('mobile-day-select');
            select.innerHTML = appData.days.map(day => `<option value="${day.id}">${day.full} — ${day.focus}</option>`).join('');
        }

        function selectDay(id) {
            currentDayId = id;
            document.querySelectorAll('.day-card').forEach(card => card.classList.remove('active'));
            const card = document.getElementById(`day-card-${id}`);
            if (card) card.classList.add('active');
            document.getElementById('mobile-day-select').value = id;

            const day = appData.days[id];
            document.getElementById('current-day-title').innerText = day.full;
            document.getElementById('current-day-focus').innerText = day.focus;

            // Auto-calculate the first incomplete exercise
            const sequence = getRoutineSequence();
            activeExerciseIndex = sequence.findIndex(item => {
                const key = item.type === 'exercise' ? `${currentDayId}_${item.originalIndex}` : `${currentDayId}_${item.type}`;
                return (progress[key] || 0) < item.sets;
            });
            if (activeExerciseIndex === -1) activeExerciseIndex = 0;

            renderExerciseNav();
            renderExercises();
        }

        function getRoutineSequence() {
            const routine = appData.routines[currentDayId];
            const isNight = appData.days[currentDayId].isNight;
            let sequence = [];
            if (!isNight) sequence.push({ ...appData.globalSections.warmup, type: 'warmup', sets: 1 });
            routine.forEach((ex, idx) => sequence.push({ ...ex, type: 'exercise', originalIndex: idx }));
            if (!isNight) sequence.push({ ...appData.globalSections.cooldown, type: 'cooldown', sets: 1 });
            return sequence;
        }

        function renderExerciseNav() {
            const nav = document.getElementById('exercise-nav');
            const sequence = getRoutineSequence();
            
            nav.innerHTML = sequence.map((item, idx) => {
                const key = item.type === 'exercise' ? `${currentDayId}_${item.originalIndex}` : `${currentDayId}_${item.type}`;
                const isComplete = (progress[key] || 0) >= item.sets;
                const isActive = activeExerciseIndex === idx;
                
                let colorClass = isActive ? 'bg-teal-500 text-white shadow-lg shadow-teal-100' : 'bg-white text-slate-400 border-slate-100';
                if (isComplete && !isActive) colorClass = 'bg-teal-50 text-teal-400 border-teal-100 opacity-60';

                return `
                    <button onclick="goToExercise(${idx})" class="flex-shrink-0 px-4 py-2 rounded-xl border text-[10px] font-black uppercase tracking-widest transition-all ${colorClass}">
                        ${item.name}
                    </button>
                `;
            }).join('');
        }

        function goToExercise(index) {
            activeExerciseIndex = index;
            renderExerciseNav();
            renderExercises();
        }

        function renderExercises() {
            const list = document.getElementById('exercise-list');
            const sequence = getRoutineSequence();
            
            // If all done, show finish screen
            const allDone = sequence.every(item => {
                const key = item.type === 'exercise' ? `${currentDayId}_${item.originalIndex}` : `${currentDayId}_${item.type}`;
                return (progress[key] || 0) >= item.sets;
            });

            if (allDone) {
                list.innerHTML = `
                    <div class="bg-teal-500 text-white p-12 rounded-[2.5rem] text-center shadow-2xl">
                        <div class="bg-white/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                            <svg class="w-10 h-10" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <h3 class="text-4xl font-black mb-4">Day Complete!</h3>
                        <p class="text-teal-100 mb-10 text-lg">Incredible job, Grif. Consistency builds longevity.</p>
                        <button onclick="resetDayProgress()" class="bg-white text-teal-600 font-black px-10 py-5 rounded-2xl shadow-lg hover:bg-teal-50 transition-colors">Restart Routine</button>
                    </div>
                `;
                return;
            }

            const item = sequence[activeExerciseIndex];
            const key = item.type === 'exercise' ? `${currentDayId}_${item.originalIndex}` : `${currentDayId}_${item.type}`;
            const setProgress = progress[key] || 0;
            
            if (item.type === 'exercise') {
                list.innerHTML = createExerciseHTML(item, item.originalIndex, setProgress);
            } else {
                list.innerHTML = createSectionHTML(item, item.type, setProgress);
            }
        }

        function createSectionHTML(section, type, setProgress) {
            const key = `${currentDayId}_${type}`;
            const isComplete = setProgress >= section.sets;
            
            return `
                <div id="card-${key}" class="exercise-card ${section.bgColor} ${section.textColor} p-8 md:p-12 rounded-[2.5rem] shadow-xl border-4 ${isComplete ? 'border-teal-400' : 'border-transparent'}">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-black text-3xl mb-1">${section.name}</h4>
                        ${isComplete ? '<span class="bg-white/20 px-3 py-1 rounded-lg text-[10px] font-black uppercase">Complete</span>' : ''}
                    </div>
                    <p class="text-xs font-bold uppercase tracking-widest opacity-70 mb-8">${section.target}</p>
                    <ul class="text-base md:text-lg step-list mb-12">
                        ${section.steps.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                    <button onclick="incrementSet('${key}', ${section.sets})" 
                        class="w-full bg-white text-slate-900 hover:bg-slate-100 font-black py-6 rounded-2xl transition-all flex items-center justify-center gap-2 text-xl shadow-lg">
                        ${isComplete ? 'Redo ' : 'Complete '}${section.name}
                    </button>
                </div>
            `;
        }

        function createExerciseHTML(item, index, setProgress) {
            const details = appData.exercises[item.name];
            const key = `${currentDayId}_${index}`;
            const isComplete = setProgress >= item.sets;

            return `
                <div id="card-${key}" class="exercise-card bg-white p-8 md:p-12 rounded-[2.5rem] shadow-xl border-4 ${isComplete ? 'border-teal-400' : 'border-slate-100'}">
                    <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4 mb-8">
                        <div class="flex-1">
                            <h4 class="font-black text-3xl text-slate-800 mb-1 leading-tight">${item.name}</h4>
                            <span class="text-xs font-bold text-teal-600 uppercase tracking-widest">${details.target}</span>
                        </div>
                        <a href="${details.video}" target="_blank" class="inline-flex items-center gap-2 bg-rose-50 text-rose-500 font-bold px-4 py-3 rounded-xl hover:bg-rose-100 transition-colors self-start">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                            <span class="text-sm">Video</span>
                        </a>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-8">
                        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <span class="block text-[9px] font-bold text-slate-400 uppercase mb-1 tracking-wider">Sets</span>
                            <span class="font-black text-slate-800 text-xl">${item.sets}</span>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                            <span class="block text-[9px] font-bold text-slate-400 uppercase mb-1 tracking-wider">Reps</span>
                            <span class="font-black text-slate-800 text-xl">${item.reps}</span>
                        </div>
                    </div>

                    <div class="mb-10">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Execution</p>
                        <ul class="text-sm md:text-base step-list text-slate-600">
                            ${details.steps.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    </div>

                    <button onclick="incrementSet('${key}', ${item.sets})" 
                        class="w-full ${isComplete ? 'bg-teal-50 text-teal-600 border-2 border-teal-200' : 'bg-teal-500 text-white shadow-xl shadow-teal-100'} font-black py-6 rounded-2xl active:scale-[0.98] transition-all flex flex-col items-center justify-center text-xl relative overflow-hidden">
                        <span>${isComplete ? 'Add Extra Set' : 'Tally Set'}</span>
                        <span class="text-[10px] opacity-80 font-bold uppercase tracking-widest mt-1">${setProgress} / ${item.sets} Done</span>
                    </button>
                </div>
            `;
        }

        function incrementSet(key, max) {
            progress[key] = (progress[key] || 0) + 1;
            localStorage.setItem('workout_progress', JSON.stringify(progress));
            
            const sequence = getRoutineSequence();
            
            if (progress[key] >= max) {
                const card = document.getElementById(`card-${key}`);
                if (card) {
                    card.classList.add('poof-out');
                    setTimeout(() => {
                        // Move to next incomplete exercise if current is finished
                        const nextIncomplete = sequence.findIndex((item, idx) => {
                            const k = item.type === 'exercise' ? `${currentDayId}_${item.originalIndex}` : `${currentDayId}_${item.type}`;
                            return (progress[k] || 0) < item.sets;
                        });
                        
                        if (nextIncomplete !== -1) {
                            activeExerciseIndex = nextIncomplete;
                        }
                        
                        renderExerciseNav();
                        renderExercises();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 400);
                }
            } else {
                renderExerciseNav();
                renderExercises();
            }
            
            if (progress[key] > 0) startRestTimer();
        }

        function resetDayProgress() {
            Object.keys(progress).forEach(key => { if (key.startsWith(`${currentDayId}_`)) delete progress[key]; });
            localStorage.setItem('workout_progress', JSON.stringify(progress));
            activeExerciseIndex = 0;
            renderExerciseNav();
            renderExercises();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function startRestTimer() {
            clearInterval(timerInterval);
            timerSeconds = DEFAULT_REST;
            updateTimerUI();
            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerUI();
                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerStatus('Done!');
                    if (window.navigator.vibrate) window.navigator.vibrate([100, 30, 100]);
                }
            }, 1000);
            timerStatus('Resting...');
        }

        function toggleTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                timerStatus('Paused');
            } else {
                startRestTimer();
            }
        }

        function updateTimerUI() {
            const display = document.getElementById('timer-display');
            const progressCircle = document.getElementById('timer-progress');
            const offset = 175.9 - (175.9 * (timerSeconds / DEFAULT_REST));
            display.innerText = timerSeconds + 's';
            progressCircle.style.strokeDashoffset = offset;
        }

        function timerStatus(msg) {
            document.getElementById('timer-status').innerText = msg;
        }
    </script>
</body>
</html>
